<div class='mt-4'>
  <div>
    <h3>News Trash</h3>
    <a href="/news/list">List</a>
  </div>
    <table class='table'>
        <thead>
            <tr style="text-align: center;">
                <th scope='col'>#</th>
                <th scope='col'>Slug</th>
                <th scope='col'>Image</th>
                <th scope='col'></th>
            </tr>
        </thead>
        <tbody style="vertical-align: middle;">
            {{#each news}}
            <tr style="text-align: center;">
                <th scope='row'>{{@index}}</th>
                <td>{{this.slug}}</td>
                <td>
                    <a href="/news/{{this.slug}}">
                    <img src="{{this.image}}" alt="image" style="height: 50px; border-radius: 5px;">
                    </a>
                </td>
                <td>
                  <span data-bs-id="{{this._id}}" class="btn btn-primary restore">Restore</span>
                    <a href="/news/{{this._id}}/edit" class="btn btn-primary">Edit</a>
                    <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-id="{{this._id}}" data-bs-target="#deleteConfirm">Hard Delete</a>
                </td>
            </tr>

            {{else}}
            <td colspan="4" style="text-align: center; vertical-align: middle;">
            <p style="margin: 0;">Trash Is Empty
            </p>
            </td>
            {{/each}}
        </tbody>
    </table>
</div>

{{!-- Delete Confirm --}}

<div class="modal" tabindex="-1" id="deleteConfirm">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Confirm</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Delete News?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-danger">Delete</button>
      </div>
    </div>
  </div>
</div>

{{!-- Modal handler --}}

<script>
    var id = '';
    const modal = document.getElementById('deleteConfirm')
if (modal) {
  modal.addEventListener('show.bs.modal', event => {
    const button = event.relatedTarget
    const recipient = button.getAttribute('data-bs-id')
    id = recipient;
  })
}
var btnDeleteNews = document.querySelector('.btn-danger');
var btnRestoreNews = document.querySelectorAll('.restore');

function deleteNews() {
    fetch(`/news/${id}/hardDelete`, {
        method: "DELETE",
        body: null,
        headers: {
        "Content-type": "application/json"
        }
    })
    .then(() => location.reload())
    .catch(() => console.log('bug!!!'));
}

btnDeleteNews.onclick = deleteNews;
for(i = 0; i < btnRestoreNews.length; i++) {
  btnRestoreNews[i].onclick = (e) => {
    console.log(`/news/${e.target.getAttribute('data-bs-id')}/restore`);
    fetch(`/news/${e.target.getAttribute('data-bs-id')}/restore`, {
        method: "PATCH",
        body: null,
        headers: {
        "Content-type": "application/json"
        }
    })
    .then(() => location.reload())
    .catch(() => console.log('bug!!!'));
};
};

</script>